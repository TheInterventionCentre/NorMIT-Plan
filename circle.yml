dependencies:
  override:
    - sudo apt-get update
    - sudo apt-get install cmake3 subversion qt4-qmake libqt4-dev python-dev
    - if [[ ! -e ~/Slicer-v4.8.0-src ]]; then curl https://s3-us-west-1.amazonaws.com/normit-plan.circleci/Slicer-v4.8.0-src.tar.gz | tar xj -C /home/ubuntu; fi
    - if [[ ! -e ~/Slicer-v4.8.0-build ]]; then curl https://s3-us-west-1.amazonaws.com/normit-plan.circleci/Slicer-v4.8.0-build.tar.gz |tar xj -C /home/ubuntu; fi
  cache_directories:
    - "/home/ubuntu/Slicer-v4.8.0-build"
    - "/home/ubuntu/Slicer-v4.8.0-src"

compile:
  override:
    - mkdir /home/ubuntu/NorMIT-Plan-build
    - cd /home/ubuntu/NorMIT-Plan-build; cmake ../NorMIT-Plan -DSlicer_DIR=/home/ubuntu/Slicer-v4.8.0-build/Slicer-build
    - cd /home/ubuntu/NorMIT-Plan-build; cmake .
    - if [ $(git rev-parse --abbrev-ref HEAD) == "development" ]; then export DASHBOARD_TRACK=Continuous; else export DASHBOARD_TRACK=Experimental; fi
    - cd /home/ubuntu/NorMIT-Plan-build; make ${DASHBOARD_TRACK}Start
    - cd /home/ubuntu/NorMIT-Plan-build; make ${DASHBOARD_TRACK}Configure
    - cd /home/ubuntu/NorMIT-Plan-build; make ${DASHBOARD_TRACK}Build

test:
  override:
    - cd /home/ubuntu/NorMIT-Plan-build; make ${DASHBOARD_TRACK}Test
    - cd /home/ubuntu/NorMIT-Plan-build; make ${DASHBOARD_TRACK}Submit
